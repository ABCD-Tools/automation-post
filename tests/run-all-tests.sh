#!/bin/bash

# Test Runner Script
# Runs all test suites and generates comprehensive report

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘            VISUAL RECORDER TEST SUITE RUNNER              â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Starting test execution..."
echo ""

# Colors
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Test results
TOTAL_PASSED=0
TOTAL_FAILED=0

# Create test reports directory
mkdir -p ./test-reports

# Test 1: Integration Tests
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Running: Integration Tests (Data Flow & Components)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
node tests/integration.test.js
INTEGRATION_EXIT=$?

if [ $INTEGRATION_EXIT -eq 0 ]; then
    echo -e "${GREEN}âœ… Integration tests passed${NC}"
    ((TOTAL_PASSED++))
else
    echo -e "${RED}âŒ Integration tests failed${NC}"
    ((TOTAL_FAILED++))
fi
echo ""

# Test 2: Edge Cases and Error Handling
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Running: Edge Cases & Error Handling Tests"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
node tests/edge-cases.test.js
EDGE_EXIT=$?

if [ $EDGE_EXIT -eq 0 ]; then
    echo -e "${GREEN}âœ… Edge case tests passed${NC}"
    ((TOTAL_PASSED++))
else
    echo -e "${RED}âŒ Edge case tests failed${NC}"
    ((TOTAL_FAILED++))
fi
echo ""

# Test 3: Visual Executor Tests
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Running: Visual Executor Tests"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
node src/modules-client/visual-executor.test.js
VISUAL_EXIT=$?

if [ $VISUAL_EXIT -eq 0 ]; then
    echo -e "${GREEN}âœ… Visual executor tests passed${NC}"
    ((TOTAL_PASSED++))
else
    echo -e "${RED}âŒ Visual executor tests failed${NC}"
    ((TOTAL_FAILED++))
fi
echo ""

# Final Summary
TOTAL_TESTS=$((TOTAL_PASSED + TOTAL_FAILED))

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                   FINAL TEST SUMMARY                      â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Test Suites:"
echo "  â€¢ Integration Tests:      $([ $INTEGRATION_EXIT -eq 0 ] && echo -e "${GREEN}âœ… PASSED${NC}" || echo -e "${RED}âŒ FAILED${NC}")"
echo "  â€¢ Edge Case Tests:        $([ $EDGE_EXIT -eq 0 ] && echo -e "${GREEN}âœ… PASSED${NC}" || echo -e "${RED}âŒ FAILED${NC}")"
echo "  â€¢ Visual Executor Tests:  $([ $VISUAL_EXIT -eq 0 ] && echo -e "${GREEN}âœ… PASSED${NC}" || echo -e "${RED}âŒ FAILED${NC}")"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo -e "Total Test Suites: ${TOTAL_TESTS}"
echo -e "Passed: ${GREEN}${TOTAL_PASSED}${NC}"
echo -e "Failed: ${RED}${TOTAL_FAILED}${NC}"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

if [ $TOTAL_FAILED -eq 0 ]; then
    echo ""
    echo -e "${GREEN}ğŸ‰ ALL TEST SUITES PASSED!${NC}"
    echo ""
    exit 0
else
    echo ""
    echo -e "${RED}âš ï¸  SOME TEST SUITES FAILED${NC}"
    echo ""
    exit 1
fi
